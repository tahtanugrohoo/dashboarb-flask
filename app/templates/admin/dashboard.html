{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
  <h1>Dashboard Admin</h1>

  <div style="display:flex; gap:16px; flex-wrap:wrap; margin-bottom:16px;">
    <div style="padding:12px; border:1px solid #eee; border-radius:10px; min-width:220px;">
      <div>Total respons</div>
      <b style="font-size:24px;">{{ total_responses }}</b>
    </div>

    <div style="padding:12px; border:1px solid #eee; border-radius:10px; min-width:220px;">
      <div>Total responden (unik)</div>
      <b style="font-size:24px;">{{ total_respondents }}</b>
    </div>
  </div>

  <h2 style="margin-top:24px;">Tren Respons per Hari</h2>
  <div style="background:#fff; border:1px solid #eee; border-radius:10px; padding:12px;">
    <canvas id="responsesChart"></canvas>
  </div>

  <h2 style="margin-top:24px;">Distribusi Jawaban</h2>
  <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
    <div style="background:#fff; border:1px solid #eee; border-radius:10px; padding:12px;">
      <h3>Q1 (Kapan menggunakan AI)</h3>
      <canvas id="q1Chart"></canvas>
    </div>

    <div style="background:#fff; border:1px solid #eee; border-radius:10px; padding:12px;">
      <h3>Q2 (Tujuan utama)</h3>
      <canvas id="q2Chart"></canvas>
    </div>
    <p>
      Export ringkasan: <a href="{{ url_for('export.export_summary_csv') }}">summary.csv</a>
    </p>
  </div>

  <form method="post" action="{{ url_for('admin.logout') }}" style="margin-top:12px;">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <button class="btn" type="submit">Logout</button>
  </form>


  <!-- Kirim data dari Flask ke JS via JSON payload -->
  <script type="application/json" id="chart-data">
    {{ {
      "chart_labels": chart_labels,
      "chart_values": chart_values,
      "q1_labels": q1_labels,
      "q1_values": q1_values,
      "q2_labels": q2_labels,
      "q2_values": q2_values
    } | tojson }}
  </script>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    const payload = JSON.parse(document.getElementById('chart-data').textContent);

    // Tren respons per tanggal
    const labels = payload.chart_labels || [];
    const values = payload.chart_values || [];

    new Chart(document.getElementById('responsesChart'), {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Jumlah Respons',
          data: values
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true }
        }
      }
    });

    // Distribusi jawaban Q1 & Q2
    const q1Labels = payload.q1_labels || [];
    const q1Values = payload.q1_values || [];
    const q2Labels = payload.q2_labels || [];
    const q2Values = payload.q2_values || [];

    new Chart(document.getElementById('q1Chart'), {
      type: 'bar',
      data: {
        labels: q1Labels,
        datasets: [{
          label: 'Jumlah',
          data: q1Values
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true }
        }
      }
    });

    new Chart(document.getElementById('q2Chart'), {
      type: 'bar',
      data: {
        labels: q2Labels,
        datasets: [{
          label: 'Jumlah',
          data: q2Values
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
  </script>
{% endblock %}
